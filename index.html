<!DOCTYPE html>
<html lang="es">
<head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title>Login JSONP</title></head>
<body>
  <div id="estado">Verificando backend…</div>
  <pre id="response"></pre>
  <script>
    const BACKEND = 'https://script.google.com/macros/s/AKfycbzthO1nOeoZEdP6vN-ir-r1EuvBFBqxzqja1cOW0ODegT_pEfj77674btHyeCzyy9A8/exec';
    function verify() {
      fetch(BACKEND)
        .then(r=>r.json())
        .then(j=>{ document.getElementById('estado').textContent='✅ '+j.mensaje; loginForm(); })
        .catch(e=>{ document.getElementById('estado').textContent='❌ Error backend: '+e; });
    }
    function loginForm() {
      document.body.insertAdjacentHTML('beforeend', `
        <h3>Login</h3>
        <input id="u" placeholder="Usuario"/><input id="p" placeholder="Clave"/>
        <button onclick="login()">Entrar</button>
      `);
    }
    function login() {
      const u=encodeURIComponent(document.getElementById('u').value);
      const p=encodeURIComponent(document.getElementById('p').value);
      const cb = 'cb'+Date.now();
      window[cb] = function(data) {
        document.getElementById('response').textContent = JSON.stringify(data,null,2);
        delete window[cb];
        document.head.removeChild(script);
      };
      const script = document.createElement('script');
      script.src = `${BACKEND}?username=${u}&password=${p}&jsonpCallback=${cb}`;
      document.head.appendChild(script);
    }
    verify();
  </script>
</body>
</html>
